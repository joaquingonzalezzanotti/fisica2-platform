<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fisica II - Learning Dashboard</title>
  <link rel="icon" type="image/png" href="assets/img/favicon.png" />
  <!-- KaTeX para renderizar formulas en quizzes y practicos -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body);"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body);"></script>
  <style>
    :root {
      --bg: #f6f8fb;
      --panel: #ffffff;
      --muted: #5b6475;
      --text: #131722;
      --accent: #006d77;
      --accent-soft: rgba(0, 109, 119, 0.1);
      --border: #e3e7ef;
      --shadow: 0 12px 30px rgba(17, 24, 39, 0.08);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Manrope', 'Segoe UI', sans-serif;
      background: radial-gradient(circle at 20% 20%, rgba(0,109,119,0.05), transparent 35%),
                  radial-gradient(circle at 80% 10%, rgba(0,109,119,0.08), transparent 30%),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
    }
    .layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      min-height: 100vh;
    }
    .layout.collapsed {
      grid-template-columns: 76px 1fr;
    }
    .layout.collapsed aside {
      padding: 12px 8px;
      width: 76px;
    }
    aside {
      background: linear-gradient(160deg, #0d1b2a, #1b263b);
      color: #e9edf5;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
    }
    .brand { display: flex; align-items: center; gap: 12px; }
    .brand-icon {
      width: 40px; height: 40px; border-radius: 12px;
      background: linear-gradient(135deg, #38bdf8, #22d3ee);
      display: grid; place-items: center; font-weight: 700; color: #0b132b;
    }
    .brand h1 { margin: 0; font-size: 18px; line-height: 1.2; }
    .brand-row { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    .hamburger {
      width: 36px; height: 36px;
      border-radius: 10px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.15);
      display: grid; place-items: center;
      cursor: pointer;
      transition: background 0.15s ease, border 0.15s ease;
      margin-top: -4px;
    }
    .hamburger:hover { background: rgba(255,255,255,0.16); }
    .hamburger span {
      display: block;
      width: 18px; height: 2px;
      background: #e9edf5;
      margin: 3px 0;
      border-radius: 999px;
    }
    .sidebar-section h2 {
      font-size: 14px; text-transform: uppercase; letter-spacing: 0.08em;
      color: #94a3b8; margin: 0 0 8px 0;
    }
    .module-list { display: flex; flex-direction: column; gap: 8px; }
    .module-item {
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.04);
      color: #e9edf5;
      cursor: pointer;
      transition: all 0.18s ease;
      font-size: 14px;
      line-height: 1.3;
    }
    .module-item:hover { background: rgba(255,255,255,0.08); }
    .module-item.active {
      background: #e0fbfc; color: #0b132b; border-color: transparent;
      box-shadow: 0 10px 30px rgba(0,0,0,0.18);
    }
    .module-circle {
      display: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #e0fbfc;
      color: #0b132b;
      font-weight: 800;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .module-text {
      flex: 1;
    }
    .layout.collapsed aside .brand { display: none; }
    .layout.collapsed aside .sidebar-section h2 { display: none; }
    .layout.collapsed .module-item {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px;
    }
    .layout.collapsed .module-item .module-text {
      display: none;
    }
    .layout.collapsed .module-item .module-circle {
      display: inline-flex;
      width: 28px;
      height: 28px;
      font-size: 13px;
    }
    main {
      padding: 28px 32px 32px 32px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      width: 85%;
      max-width: 1400px;
      margin: 0 auto;
    }
    .header {
      display: flex; flex-wrap: wrap; gap: 12px; align-items: center; justify-content: space-between;
    }
    .header-left h2 { margin: 0; font-size: 26px; }
    .header-left p { margin: 4px 0 0 0; color: var(--muted); font-size: 14px; }
    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: #e2e8f0;
      color: var(--muted);
      font-size: 12px;
      font-weight: 600;
    }
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .card h3 { margin: 0; font-size: 17px; color: var(--text); }
    .card p, .card li {
      margin: 0; color: var(--muted); font-size: 14px; line-height: 1.5;
    }
    details { margin-bottom: 10px; }
    .card li + li { margin-top: 4px; }
    details summary { cursor: pointer; font-weight: 700; color: var(--text); list-style: none; }
    details summary::marker { display: none; }
    details summary::-webkit-details-marker { display: none; }
    details { border: 1px solid var(--border); border-radius: 12px; padding: 12px 14px; background: #f8fafc; }
    .chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .section-stack { display: flex; flex-direction: column; gap: 12px; }
    .theory-stack { display: flex; flex-direction: column; gap: 12px; }
    .toggle-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .mini-btn {
      border: 1px solid var(--border);
      background: #e2e8f0;
      color: var(--text);
      padding: 6px 10px;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
    }
    .align-right { margin-left: auto; }
    button {
      border: none; background: var(--accent); color: #fff; font-weight: 700;
      padding: 10px 14px; border-radius: 12px; cursor: pointer;
      box-shadow: 0 10px 20px rgba(0,109,119,0.2);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    button:hover { transform: translateY(-1px); }
    .quiz { display: grid; gap: 12px; }
    .quiz-item {
      border: 1px solid var(--border); border-radius: 12px; padding: 12px; background: #fdfefe;
    }
    .quiz-question {
      margin-bottom: 8px;
      padding: 10px 12px;
      background: #fff7c2;
      border: 1px solid #f4e28e;
      border-radius: 10px;
      font-weight: 700;
      text-decoration: underline;
      text-decoration-color: #f1c40f;
    }
    .options { display: grid; gap: 8px; margin-top: 8px; }
    .option {
      border: 1px solid var(--border); border-radius: 10px; padding: 10px;
      cursor: pointer; transition: all 0.15s ease; background: #fff;
    }
    .option:hover { border-color: var(--accent); }
    .option.selected { border-color: var(--accent); background: var(--accent-soft); }
    .option.correct { border-color: #22c55e; background: #e8f8ef; }
    .option.incorrect { border-color: #ef4444; background: #fdecec; }
    .status { font-weight: 700; font-size: 13px; margin-top: 6px; }
    .hidden { display: none !important; }
    .tab-row { display: flex; gap: 8px; margin-bottom: 8px; }
    .tab-btn {
      border: 1px solid var(--border);
      background: #f1f5f9;
      color: var(--text);
      padding: 12px 16px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      font-size: 15px;
    }
    .tab-btn.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
      box-shadow: 0 8px 20px rgba(0,109,119,0.2);
    }
    .practice-item {
      display: none;
    }
    .slides-status { color: var(--muted); font-size: 13px; margin: 0; }
    .exercise-card {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 12px;
      background: linear-gradient(145deg, #f8fbff, #f2f6fb);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.08);
    }
    .exercise-card .meta { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 8px; }
    .exercise-card .meta .pill { background: #e0f2fe; color: #0f172a; }
    .exercise-actions { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
    .exercise-body { margin-top: 8px; line-height: 1.55; color: var(--text); }
    .exercise-body img { max-width: 100%; border-radius: 10px; border: 1px solid var(--border); margin-top: 10px; }
    .summary-img {
      width: 100%;
      max-width: 1200px;
      object-fit: contain;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #f8fafc;
      padding: 12px;
      margin: 12px auto 0 auto;
      display: block;
    }
    /* Nueva UI de practicos */
    .practice-section {
      display: grid;
      gap: 14px;
      padding: 4px 2px 0 2px;
    }
    .practice-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .practice-head h4 {
      margin: 0;
      font-size: 16px;
      color: var(--text);
    }
    .practice-grid {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .practice-card {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 14px;
      background: #ffffff;
      box-shadow: 0 8px 18px rgba(17, 24, 39, 0.06);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    .practice-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 28px rgba(17, 24, 39, 0.08);
    }
    .practice-title {
      margin: 0;
      font-weight: 800;
      color: var(--text);
      font-size: 15px;
    }
    .practice-sub {
      margin: 4px 0 0 0;
      color: var(--muted);
      font-size: 13px;
    }
    .practice-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--accent);
      font-weight: 800;
      text-decoration: none;
      margin-top: 8px;
    }
    .practice-link::after {
      content: '';
      font-size: 12px;
    }
    .practice-cta {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: var(--accent);
      color: #fff;
      border-radius: 10px;
      font-weight: 700;
      text-decoration: none;
      margin-top: 8px;
      box-shadow: 0 8px 18px rgba(0,109,119,0.25);
    }
    .exercise-chip {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: #e2e8f0;
      color: #0f172a;
      font-weight: 700;
      font-size: 12px;
      text-transform: lowercase;
    }
    .exercise-chip.accent {
      background: rgba(0,109,119,0.14);
      color: var(--accent);
    }
    .practice-empty {
      color: var(--muted);
      margin: 0;
    }
    .exercise-actions button {
      padding: 8px 12px;
      border-radius: 10px;
      font-size: 13px;
      box-shadow: none;
    }
    @media (max-width: 960px) {
      .layout { grid-template-columns: 1fr; }
      aside { position: relative; height: auto; }
    }
  </style>
</head>
<body>
  <div class="layout">
    <aside>
      <div class="brand-row">
        <div class="brand">
          <div class="brand-icon">F2</div>
          <div>
            <h1>Fisica II 2025</h1>
            <div style="color:#cbd5e1;font-size:12px;">Vista dinamica  Programa y Unidades</div>
          </div>
        </div>
        <button id="toggleSidebar" class="hamburger" aria-label="Toggle menu">
          <span></span><span></span><span></span>
        </button>
      </div>
      <div class="sidebar-section">
        <h2>Modulos</h2>
        <div class="module-list" id="moduleList"></div>
      </div>
    </aside>
    <main>
      <div class="header">
        <div class="header-left">
          <h2 id="moduleTitle">Selecciona un modulo</h2>
          <p id="moduleSubtitle">Basado en Programa de Fisica II 2025.</p>
        </div>
        <div class="toggle-row">
          <span class="pill" id="folderHint">Estructura: inputs/modulos/modulo#/</span>
        </div>
      </div>

      <div class="section-stack">
        <div class="card" id="summaryCard">
          <div class="toggle-row" style="justify-content:space-between;">
            <h3 style="margin:0;">Resumen</h3>
            <button id="summaryToggle" class="mini-btn">Ocultar</button>
          </div>
          <div id="summaryBody">
            <p id="moduleSummary">Usa la barra lateral para explorar las unidades del programa.</p>
            <div class="chips" id="moduleSources"></div>
            <div id="summaryImageWrap"></div>
            <div id="moduleConcepts" style="margin-top:8px;"></div>
          </div>
        </div>

        <div class="card" id="conceptsCard">
          <div class="tab-row">
            <button class="tab-btn active" data-tab="teorico">Teorico</button>
            <button class="tab-btn" data-tab="practicos">Practicos</button>
          </div>
          <div id="theoryPanel" class="theory-stack">
            <div id="slidesCard" class="card" style="box-shadow:none;border:1px solid var(--border);">
              <div class="toggle-row">
                <h3 style="margin:0;">Filminas del modulo</h3>
                <span class="pill" id="slidesHint">inputs/modulos/modulo#/filminas#</span>
                <select id="slidesSelect" style="padding:8px 10px;border-radius:10px;border:1px solid var(--border);font-weight:600;background:#f8fafc;min-width:220px;"></select>
                <button id="slidesCollapse" class="mini-btn align-right">Ocultar</button>
              </div>
              <div id="slidesBody">
                <p id="slidesStatus" class="slides-status">Cargando...</p>
                <div id="slidesViewer" style="border:1px solid var(--border);border-radius:12px;overflow:hidden;background:#f8fafc;color:var(--muted);">
                  <div style="padding:12px;">Selecciona una filmina para ver el PDF.</div>
                </div>
              </div>
            </div>

            <div id="pdfCard" class="card" style="box-shadow:none;border:1px solid var(--border);">
              <div class="toggle-row">
                <h3 style="margin:0;">Ver PDFs del modulo</h3>
                <select id="pdfSelect" style="padding:8px 10px;border-radius:10px;border:1px solid var(--border);font-weight:600;background:#f8fafc;">
                  <option>Selecciona modulo</option>
                </select>
                <button id="pdfToggleBtn" class="mini-btn align-right">Mostrar/Ocultar</button>
              </div>
              <div id="pdfBody">
                <div id="pdfViewer" class="hidden" style="border:1px solid var(--border);border-radius:12px;overflow:hidden;min-height:320px;background:#f8fafc;display:grid;place-items:center;color:var(--muted);">
                  Selecciona un PDF y haz clic en Mostrar/Ocultar.
                </div>
              </div>
            </div>

            <div id="quizCard" class="card" style="box-shadow:none;border:1px solid var(--border);">
              <div class="toggle-row">
                <h3 style="margin:0;">Repaso - Quiz</h3>
                <span class="pill" id="quizTitle">Selecciona modulo</span>
                <button id="quizCollapse" class="mini-btn align-right">Ocultar</button>
              </div>
              <div id="quizBody">
                <div class="quiz" id="quizZone"></div>
                <button id="gradeBtn" style="display:none;">Calificar</button>
              </div>
            </div>
          </div>
          <div id="modulePractices" class="hidden"></div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Datos con ruta actual y sugerencia de carpeta inputs/modulos/modulo#
    const modules = [
      {
        id: 'u1',
        title: 'Unidad 1: Introduccion a la termodinamica',
        summary: 'Calor, temperatura, calorimetria y equivalente mecanico del calor.',
        sources: ['Programa 2025 - Unidad 1'],
        concepts: [
          { title: 'Temperatura y medicion', points: ['Escalas termometricas (Celsius, Fahrenheit, Kelvin) y cero absoluto.', 'Termometros como dispositivos de equilibrio termico y propiedades termometricas (volumen, presion, resistencia).'] },
          { title: 'Calor y energia interna', points: ['Calor como transferencia de energia; calorimetria (Q = m c T).', 'Energia interna: suma de energias microscopicas; variables de estado vs transferencia.'] },
          { title: 'Dilatacion y comportamiento del agua', points: ['Coeficientes de dilatacion lineal/superficial/volumetrica; agua 04 C aumenta densidad.'] },
          { title: 'Equivalente mecanico', points: ['Relacion trabajo-energia termica; 1 cal  4,186 J.'] }
        ],
        folder: 'inputs/modulos/modulo1/',
        slidesFolder: 'inputs/modulos/modulo1/filminas1/',
        pdfs: [
          { label: 'Unidad 1 C1 - Fundamentos de termologia', file: 'inputs/modulos/modulo1/Unidad 1 C1-Fundamentos de termolog\u00eda.pdf' },
          { label: 'Unidad 1 C2 - Energia interna', file: 'inputs/modulos/modulo1/Unidad 1-C2- Concepto de energ\u00eda interna.pdf' },
          { label: 'Unidad 1 C3 - Transformaciones en gases', file: 'inputs/modulos/modulo1/Unidad 1-C3-Transformaciones en gases.pdf' }
        ],
        practices: [
          { title: 'Practico 1 - Fundamentos de Termologia', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 1', note: 'Temperatura, contacto termico y equilibrio.' },
          { title: 'Practico 2 - Calorimetria', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 2', note: 'Capacidad termica, mezclas y equilibrio.' }
        ]
      },
      {
        id: 'u2',
        title: 'Unidad 2: Principios de la termodinamica',
        summary: 'Primera y segunda ley, ciclos de Carnot e invertido, entropia y rendimiento.',
        sources: ['Programa 2025 - Unidad 2'],
        concepts: [
          { title: 'Primera ley', points: ['dE = Q + W; signo Q>0 hacia el sistema, W>0 sobre el sistema.', 'Trabajo como area bajo la curva P-V; casos isobarico, isocorico, isotermico, adiabatico.'] },
          { title: 'Procesos adiabaticos', points: ['Q = 0; relaciones PV^ = cte y TV^(-1) = cte;  = Cp/Cv.', 'En expansion adiabatica E_int disminuye, en compresion aumenta.'] },
          { title: 'Segunda ley y maquinas termicas', points: ['Enunciados Kelvin-Planck y Clausius; imposibilidad de eficiencia 100%.', 'Maquina de Carnot: dos isotermas + dos adiabaticas; eficiencia e = 1 - Tc/Th.'] },
          { title: 'Entropia', points: ['dS = Q_rev / T; variable de estado.', 'En procesos reales S_universo > 0; en reversibles S_universo = 0.'] }
        ],
        folder: 'inputs/modulos/modulo2/',
        slidesFolder: 'inputs/modulos/modulo2/filminas2/',
        pdfs: [
          { label: 'Unidad 2 C4 - Los principios de la termodinamica', file: 'inputs/modulos/modulo2/Unidad 2- C4 Los principios de la termodin\u00e1mica.pdf' }
        ],
        practices: [
          { title: 'Practico 3 - Transformaciones en gases', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 3', note: 'Trabajo y calor en isoterma, isobara, isocora, adiabatica.' },
          { title: 'Practico 4 - Primer Principio', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 4', note: 'Balances de energia en procesos simples.' },
          { title: 'Practico 5 - Segundo Principio', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 5', note: 'Carnot, rendimiento y entropia.' }
        ]
      },
      {
        id: 'u3',
        title: 'Unidad 3: Electrostatica y campo electrico',
        summary: 'Carga electrica, Ley de Coulomb, campo electrico y flujo (Gauss).',
        sources: ['Programa 2025 - Unidad 3'],
        concepts: [
          { title: 'Carga electrica', points: ['Signo, cuantizacion y conservacion; interaccion atractiva/repulsiva.', 'Distribuciones discretas y continuas; superposicion.'] },
          { title: 'Campo electrico', points: ['Definicion, lineas de campo y magnitud de cargas puntuales.', 'Flujo electrico y simetria (Gauss); superficies plana, cilindrica, esferica.'] }
        ],
        folder: 'inputs/modulos/modulo3/',
        slidesFolder: 'inputs/modulos/modulo3/filminas3/',
        pdfs: [
          { label: 'Unidad 3 C5 - Ley de Coulomb y Campo electrico', file: 'inputs/modulos/modulo3/Unidad 3-C5- Ley de Coulomb-Campo E\u00e9ctrico.pdf' },
          { label: 'Unidad 3 C6 - Electrostatica y campos electricos 2', file: 'inputs/modulos/modulo3/Unidad 3-C6- Electrost\u00e1tica y campos el\u00e9ctricos 2\u00b0 parte.pdf' }
        ],
        practices: [
          { title: 'Practico 6 - Carga y Campo Electrico', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 6', note: 'Calculo de campo por cargas discretas y continuas.' },
          { title: 'Practico 7 - Trabajo y Energia Potencial', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 7', note: 'Relacion campo-potencial y energia almacenada.' }
        ]
      },
      {
        id: 'u4',
        title: 'Unidad 4: Potencial electrico',
        summary: 'Trabajo en campo electrostatico, potencial, gradiente y aplicaciones.',
        sources: ['Programa 2025 - Unidad 4'],
        concepts: [
          { title: 'Trabajo y potencial', points: ['Trabajo en campo electrostatico; potencial de cargas puntuales y distribuciones.', 'Relacion entre energia potencial y diferencia de potencial.'] },
          { title: 'Campo desde potencial', points: ['E = -grad V; uso de simetria para derivar campos.', 'Equipotenciales y lineas de campo; aplicaciones basicas.'] }
        ],
        folder: 'inputs/modulos/modulo4/',
        slidesFolder: 'inputs/modulos/modulo4/filminas4/',
        pdfs: [
          { label: 'Unidad 4 C7 - El potencial electrico', file: 'inputs/modulos/modulo4/Unidad 4-C7- El potencial el\u00e9ctrico.pdf' }
        ],
        practices: [
          { title: 'Practico 7 - Trabajo y Potencial', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 7', note: 'Potencial de cargas puntuales y distribuciones.' }
        ]
      },
      {
        id: 'u5',
        title: 'Unidad 5: Capacidad y capacitores',
        summary: 'Capacitancia, conexiones serie/paralelo, energia en capacitores y propiedades electricas de la materia.',
        sources: ['Programa 2025 - Unidad 5'],
        concepts: [
          { title: 'Capacitancia', points: ['Dependencia geometrica y diel\u00e9ctrico.', 'Serie y paralelo para capacidad equivalente.', 'Capacidad en geometrias plana, cilindrica, esferica.'] },
          { title: 'Energia', points: ['E = 1/2 C V^2; densidad de energia.', 'Descarga y riesgos.', 'Rol del diel\u00e9ctrico y ruptura.'] }
        ],
        folder: 'inputs/modulos/modulo5/',
        slidesFolder: 'inputs/modulos/modulo5/filminas5/',
        pdfs: [
          { label: 'Unidad 5 - Propiedades electricas y capacidad', file: 'inputs/modulos/modulo5/Unidad 5 Propiedades el\u00e9ctricas de la materia y la capacidad el\u00e9ctrica.pdf' }
        ],
        practices: [
          { title: 'Practico 8 - Dielectrico y Condensadores', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 8', note: 'Capacitores planos, cilindricos, esfericos y con dielectrico.' }
        ]
      },
      {
        id: 'u6',
        title: 'Unidad 6: La corriente electrica',
        summary: 'Corriente electrica, modelo de conduccion, ley de Ohm y variacion de la resistencia con la temperatura.',
        sources: ['Programa 2025 - Unidad 6'],
        concepts: [
          { title: 'Corriente y carga', points: ['Flujo de carga por unidad de tiempo.', 'Relacion con densidad de corriente.', 'Sentido convencional vs movimiento de electrones.'] },
          { title: 'Ley de Ohm y potencia', points: ['I = V/R en conductores ohmicos.', 'Potencia P = I^2 R y variacion con temperatura.', 'Modelo microscopico de conduccion.'] }
        ],
        folder: 'inputs/modulos/modulo6/',
        slidesFolder: 'inputs/modulos/modulo6/filminas6/',
        pdfs: [
          { label: 'Unidad 6 - La corriente electrica', file: 'inputs/modulos/modulo6/unidad 6 La corriente el\u00e9ctrica.pdf' }
        ],
        practices: [
          { title: 'Practico 9 - Corriente Electrica', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 9', note: 'Ley de Ohm, potencia de Joule y conductividad.' }
        ]
      },
      {
        id: 'u7',
        title: 'Unidad 7: Circuito de corriente continua',
        summary: 'Circuitos de CC con fem, resistencias en serie/paralelo y reglas de Kirchhoff.',
        sources: ['Programa 2025 - Unidad 7'],
        concepts: [
          { title: 'Analisis de redes', points: ['Kirchhoff de corrientes y tensiones.', 'Puente de Wheatstone y potenciometro.', 'Potencia disipada en redes.'] },
          { title: 'Conexiones', points: ['Serie y paralelo para resistencias y fuentes.', 'Caida de tension y division de corriente.', 'FEM internas y mallas.'] }
        ],
        folder: 'inputs/modulos/modulo7/',
        slidesFolder: 'inputs/modulos/modulo7/filminas7/',
        pdfs: [
          { label: 'Unidad 7 - El circuito electrico', file: 'inputs/modulos/modulo7/Unidad 7 El circuito el\u00e9ctrico.pdf' }
        ],
        practices: [
          { title: 'Practico 10 - Circuitos de Corriente Continua', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 10', note: 'Mallas, nodos y division de corriente/tension.' }
        ]
      },
      {
        id: 'u8',
        title: 'Unidad 8: Magnetostatica',
        summary: 'Ley de Biot-Savart y Ampere; campo de conductores y fuerzas sobre cargas/corrientes.',
        sources: ['Programa 2025 - Unidad 8'],
        concepts: [
          { title: 'Fuentes de B', points: ['Corrientes rectas, espiras, solenoides y toroides.', 'Integral de Ampere en casos simetricos.', 'Superposicion de campos.'] },
          { title: 'Fuerzas magneticas', points: ['q v B sen(theta).', 'Momento sobre espiras y razon e/m.', 'Aplicaciones: espectrometria, motores simples.'] }
        ],
        folder: 'inputs/modulos/modulo8/',
        slidesFolder: 'inputs/modulos/modulo8/filminas8/',
        pdfs: [
          { label: 'Unidad 8-1 - Magnetostatica e interaccion', file: 'inputs/modulos/modulo8/Unidad 8-1 Magnetost\u00e1tica e interacci\u00f3n magn\u00e9tica.pdf' },
          { label: 'Unidad 8-2 - Biot-Savart y Ampere', file: 'inputs/modulos/modulo8/Unidad 8-2 Ley de Biot-Savart-Ley de Ampere.pdf' }
        ],
        practices: [
          { title: 'Practico 11 - Campo de Induccion Magnetica', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 11', note: 'Aplicaciones de Biot-Savart y Ampere a geometrias simples.' }
        ]
      },
      {
        id: 'u9',
        title: 'Unidad 9: Induccion electromagnetica',
        summary: 'Ley de Faraday, fem inducida, auto/mutua induccion y energia en bobinas.',
        sources: ['Programa 2025 - Unidad 9'],
        concepts: [
          { title: 'Fem inducida', points: ['Depende de d(flux)/dt.', 'Bobinas giratorias y conductores moviles.', 'Regla de Lenz y sentido de la corriente inducida.'] },
          { title: 'Inductancia', points: ['Constante de tiempo L/R.', 'Energia almacenada 1/2 L I^2.', 'Auto vs mutua induccion.'] }
        ],
        folder: 'inputs/modulos/modulo9/',
        slidesFolder: 'inputs/modulos/modulo9/filminas9/',
        pdfs: [
          { label: 'Unidad 9 - Induccion electromagnetica', file: 'inputs/modulos/modulo9/Unidad 9 Inducci\u00f3n electromagn\u00e9tica (1).pdf' }
        ],
        practices: [
          { title: 'Practico 12 - Induccion Electromagnetica', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 12', note: 'Circuitos RL, FEM inducida, constante de tiempo.' }
        ]
      },
      {
        id: 'u10',
        title: 'Unidad 10: Propiedades magneticas de la materia',
        summary: 'Paramagnetismo, diamagnetismo, ferromagnetismo y ciclo de histeresis.',
        sources: ['Programa 2025 - Unidad 10'],
        concepts: [
          { title: 'Materiales magneticos', points: ['Respuesta a campos: para, dia y ferro.', 'Permeabilidad relativa y absoluta.', 'Dominios magneticos.'] },
          { title: 'Histeresis', points: ['Curva B-H y energia disipada.', 'Retentividad y coercitividad.', 'Ciclos y perdidas.'] }
        ],
        folder: 'inputs/modulos/modulo10/',
        slidesFolder: 'inputs/modulos/modulo10/filminas10/',
        pdfs: [
          { label: 'Unidad 10 - Propiedades magneticas de la materia', file: 'inputs/modulos/modulo10/Unidad 10 Propiedades magneticas de la materia.pdf' }
        ],
        practices: [
          { title: 'Practico 11 - Campo de Induccion Magnetica (extension cualitativa)', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 11', note: 'Propiedades magneticas de materiales (apoyo conceptual).' }
        ]
      },
      {
        id: 'u11',
        title: 'Unidad 11: Corriente alterna',
        summary: 'Generadores de CA, fasores, respuesta de R, L y C, potencia e impedancia en RLC serie.',
        sources: ['Programa 2025 - Unidad 11'],
        concepts: [
          { title: 'Fasores y ondas', points: ['Representacion senoidal de voltajes y corrientes.', 'Fase y frecuencia angular omega.', 'Voltaje RMS y corriente RMS.'] },
          { title: 'Impedancia', points: ['Z_R = R, Z_L = j omega L, Z_C = 1/(j omega C).', 'Resonancia cuando omega L = 1/omega C.', 'Factor de potencia y correccion.'] }
        ],
        folder: 'inputs/modulos/modulo11/',
        slidesFolder: 'inputs/modulos/modulo11/filminas11/',
        pdfs: [
          { label: 'Unidad 11 - Corriente Alterna', file: 'inputs/modulos/modulo11/Unidad 11 Corriente Alterna.pdf' }
        ],
        practices: [
          { title: 'Practico 13 - Corriente Alterna', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 13', note: 'Impedancias, potencia y resonancia en RLC.' }
        ]
      },
      {
        id: 'u12',
        title: 'Unidad 12: Ondas EM y ecuaciones de Maxwell',
        summary: 'Ecuacion de ondas viajeras; Maxwell integral/diferencial; velocidad y espectro EM.',
        sources: ['Programa 2025 - Unidad 12'],
        concepts: [
          { title: 'Ecuacion de onda', points: ['Relacion laplaciano-tiempo.', 'Ondas viajeras y velocidad de fase.', 'Longitud de onda y frecuencia.'] },
          { title: 'Maxwell', points: ['Unificacion de electricidad y magnetismo.', 'Corriente de desplazamiento en Ampere-Maxwell.', 'Ecuaciones en forma integral y diferencial.'] }
        ],
        folder: 'inputs/modulos/modulo12/',
        slidesFolder: 'inputs/modulos/modulo12/filminas12/',
        pdfs: [
          { label: 'Unidad 12 - Fundamentos de ondas y ecuaciones de Maxwell', file: 'inputs/modulos/modulo12/Unidad 12 Fundamentos de ondas y ecuaciones de Maxwell.pdf' }
        ],
        practices: [
          { title: 'Practico 14 - Ondas EM y Maxwell', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 14', note: 'Velocidad de propagacion, campos en el vacio.' }
        ]
      },
      {
        id: 'u13',
        title: 'Unidad 13: Optica fisica',
        summary: 'Interferencia (Young, peliculas delgadas), difraccion y polarizacion.',
        sources: ['Programa 2025 - Unidad 13'],
        concepts: [
          { title: 'Interferencia', points: ['Principio de Huygens; franjas por superposicion.', 'Peliculas delgadas y recubrimientos antirreflejo.', 'Interferometro de Michelson.'] },
          { title: 'Difraccion y polarizacion', points: ['Rendijas simples y multiples.', 'Metodos para polarizar y analizar luz.', 'Redes de difraccion y maxima.'] }
        ],
        folder: 'inputs/modulos/modulo13/',
        slidesFolder: 'inputs/modulos/modulo13/filminas13/',
        pdfs: [
          { label: 'Unidad 13 - Optica fisica', file: 'inputs/modulos/modulo13/Unidad 13 \u00e0ptica f\u00edsica.pdf' }
        ],
        practices: [
          { title: 'Practico 15 - ptica Ondulatoria', ref: 'inputs/Practico Fisica 2 2023.pdf', section: 'Seccion 15', note: 'Franjas de Young, redes de difraccion, polarizacion.' }
        ]
      }
    ];

    const PRACTICO_PDF = 'inputs/Practico Fisica 2 2023.pdf';
    const practiceChapterMap = {
      u1: [
        { title: 'Cap. 1 - Fundamentos de Termologia', page: 4 },
        { title: 'Cap. 2 - Calorimetria', page: 9 }
      ],
      u2: [
        { title: 'Cap. 3 - Transformaciones en Gases', page: 20 },
        { title: 'Cap. 4 - 1er Principio de la Termodinamica', page: 28 },
        { title: 'Cap. 5 - 2do Principio de la Termodinamica', page: 33 }
      ],
      u3: [
        { title: 'Cap. 6 - Carga y Campo Electrico', page: 36 }
      ],
      u4: [
        { title: 'Cap. 7 - Trabajo y Energia Potencial Electrostatica', page: 51 }
      ],
      u5: [
        { title: 'Cap. 8 - Dielectrico y Condensadores', page: 58 }
      ],
      u6: [
        { title: 'Cap. 9 - La Corriente Electrica', page: 68 }
      ],
      u7: [
        { title: 'Cap. 10 - Circuitos de Corriente Continua', page: 78 }
      ],
      u8: [
        { title: 'Cap. 11 - Campo de Induccion Magnetica', page: 88 }
      ],
      u9: [
        { title: 'Cap. 12 - Induccion Electromagnetica', page: 101 }
      ],
      u10: [],
      u11: [
        { title: 'Cap. 13 - Corriente Alterna', page: 110 }
      ],
      u12: [
        { title: 'Cap. 14 - Ondas Electromagneticas y Ecuaciones de Maxwell', page: 118 }
      ],
      u13: [
        { title: 'Cap. 15 - Optica Ondulatoria', page: 121 }
      ]
    };
    const practiceFormulasMap = {
      u1: 'assets/img/formulas/u1.png',
      u2: 'assets/img/formulas/u2.png',
      u3: 'assets/img/formulas/u3.png',
      u4: 'assets/img/formulas/u4.png',
      u5: 'assets/img/formulas/u5.png',
      u6: 'assets/img/formulas/u6.png',
      u7: 'assets/img/formulas/u7.png',
      u8: 'assets/img/formulas/u8.png',
      u9: 'assets/img/formulas/u9.png',
      u10: 'assets/img/formulas/u10.png',
      u11: 'assets/img/formulas/u11.png',
      u12: 'assets/img/formulas/u12.png',
      u13: 'assets/img/formulas/u13.png'
    };

    const moduleList = document.getElementById('moduleList');
    const titleEl = document.getElementById('moduleTitle');
    const subtitleEl = document.getElementById('moduleSubtitle');
    const summaryEl = document.getElementById('moduleSummary');
    const sourcesEl = document.getElementById('moduleSources');
    let summaryImgEl;
    const conceptsEl = document.getElementById('moduleConcepts');
    const practicesEl = document.getElementById('modulePractices');
    const tabButtons = () => Array.from(document.querySelectorAll('.tab-btn'));
    const slidesSelect = document.getElementById('slidesSelect');
    const slidesViewer = document.getElementById('slidesViewer');
    const slidesStatus = document.getElementById('slidesStatus');
    const slidesHint = document.getElementById('slidesHint');
    const summaryImageWrap = document.getElementById('summaryImageWrap');
    const folderHintEl = document.getElementById('folderHint');
    const pdfSelect = document.getElementById('pdfSelect');
    const pdfViewer = document.getElementById('pdfViewer');
    const pdfToggleBtn = document.getElementById('pdfToggleBtn');
    const quizTitleEl = document.getElementById('quizTitle');
    const quizZone = document.getElementById('quizZone');
    const gradeBtn = document.getElementById('gradeBtn'); // legacy (oculto)

    let currentModule = null;
    let currentQuiz = [];
    let pdfVisible = false;
    let currentQuestionIndex = 0;
    let correctCount = 0;

    function renderModules() {
      moduleList.innerHTML = '';
      modules.forEach((mod, idx) => {
        const div = document.createElement('div');
        div.className = 'module-item' + (idx === 0 ? ' active' : '');
        const circle = document.createElement('span');
        circle.className = 'module-circle';
        circle.textContent = idx + 1;
        const text = document.createElement('span');
        text.className = 'module-text';
        text.textContent = mod.title;
        div.appendChild(circle);
        div.appendChild(text);
        div.addEventListener('click', () => selectModule(mod.id));
        moduleList.appendChild(div);
      });
    }

    function selectModule(id) {
      currentModule = modules.find(m => m.id === id);
      document.querySelectorAll('.module-item').forEach(item => {
        item.classList.toggle('active', item.textContent === currentModule.title);
      });
      titleEl.textContent = currentModule.title;
      subtitleEl.textContent = currentModule.summary;
      summaryEl.textContent = currentModule.summary;
      folderHintEl.textContent = `Estructura sugerida: ${currentModule.folder}`;
      sourcesEl.innerHTML = '';
      currentModule.sources.forEach(s => {
        const tag = document.createElement('span');
        tag.className = 'pill';
        tag.textContent = s;
        sourcesEl.appendChild(tag);
      });
      renderConcepts();
      renderPractices();
      loadSummaryImage();
      switchTab('teorico');
      renderSlides();
      pdfVisible = false;
      pdfViewer.classList.add('hidden');
      pdfToggleBtn.textContent = 'Mostrar PDF';
      renderPdfOptions();
      quizTitleEl.textContent = `Quiz: ${currentModule.title}`;
      quizZone.innerHTML = '<p style="color:var(--muted);margin:0;">El quiz se cargara automaticamente (aleatorio) o con "Quiz rapido".</p>';
      gradeBtn.style.display = 'none';
      currentQuiz = [];
      currentQuestionIndex = 0;
      correctCount = 0;
      // colapsar bloques teoricos al iniciar/cambiar modulo
      const slidesBody = document.getElementById('slidesBody');
      const pdfBody = document.getElementById('pdfBody');
      const quizBody = document.getElementById('quizBody');
      slidesBody?.classList.add('hidden');
      pdfBody?.classList.add('hidden');
      quizBody?.classList.add('hidden');
      const slidesCollapseBtn = document.getElementById('slidesCollapse');
      const pdfCollapseBtn = document.getElementById('pdfCollapse');
      const quizCollapseBtn = document.getElementById('quizCollapse');
      if (slidesCollapseBtn) slidesCollapseBtn.textContent = 'Mostrar';
      if (pdfCollapseBtn) pdfCollapseBtn.textContent = 'Mostrar';
      if (quizCollapseBtn) quizCollapseBtn.textContent = 'Mostrar';
      generateQuiz(); // auto-cargar quiz al seleccionar modulo
    }

    function renderConcepts() {
      conceptsEl.innerHTML = '';
      currentModule.concepts.forEach((c, i) => {
        const detail = document.createElement('details');
        if (i === 0) detail.open = true;
        const summary = document.createElement('summary');
        summary.textContent = c.title;
        detail.appendChild(summary);
        const list = document.createElement('ul');
        c.points.forEach(p => {
          const li = document.createElement('li');
          li.textContent = p;
          list.appendChild(li);
        });
        detail.appendChild(list);
        conceptsEl.appendChild(detail);
      });
    }

    function renderPractices() {
      practicesEl.innerHTML = '';
      const wrapper = document.createElement('div');
      wrapper.className = 'practice-section';

      const head = document.createElement('div');
      head.className = 'practice-head';
      const h = document.createElement('h4');
      h.textContent = 'Guia practica en PDF';
      head.appendChild(h);
      const count = document.createElement('span');
      count.className = 'pill';
      count.id = 'practiceCount';
      const chapters = practiceChapterMap[currentModule.id] || [];
      count.textContent = chapters.length ? `${chapters.length} capitulo(s)` : 'Sin capitulos asignados';
      head.appendChild(count);
      wrapper.appendChild(head);

      // Bloque de formulas por capitulo (imagen oculta por defecto)
      const formulaBlock = document.createElement('div');
      formulaBlock.className = 'card';
      formulaBlock.style.boxShadow = 'none';
      formulaBlock.style.border = '1px solid var(--border)';

      const formulaHead = document.createElement('div');
      formulaHead.className = 'toggle-row';
      const formulaTitle = document.createElement('h4');
      formulaTitle.style.margin = '0';
      formulaTitle.textContent = 'Formulas del capitulo';
      formulaHead.appendChild(formulaTitle);
      const formulaToggle = document.createElement('button');
      formulaToggle.className = 'mini-btn align-right';
      formulaToggle.textContent = 'Mostrar';
      formulaHead.appendChild(formulaToggle);
      formulaBlock.appendChild(formulaHead);

      const formulaBody = document.createElement('div');
      formulaBody.id = 'practiceFormulaBody';
      formulaBody.classList.add('hidden');
      const formulaSrc = practiceFormulasMap[currentModule.id] || '';
      const formulaImg = document.createElement('img');
      formulaImg.id = 'practiceFormulaImg';
      if (formulaSrc) formulaImg.src = formulaSrc;
      formulaImg.alt = 'Formulas del capitulo';
      formulaImg.style.width = '100%';
      formulaImg.style.maxWidth = '1100px';
      formulaImg.style.objectFit = 'contain';
      formulaImg.style.borderRadius = '12px';
      formulaImg.style.border = '1px solid var(--border)';
      formulaImg.style.background = '#f8fafc';
      formulaImg.onerror = () => { formulaImg.classList.add('hidden'); };
      formulaBody.appendChild(formulaImg);
      formulaBlock.appendChild(formulaBody);

      formulaToggle.addEventListener('click', () => {
        const hidden = formulaBody.classList.toggle('hidden');
        formulaToggle.textContent = hidden ? 'Mostrar' : 'Ocultar';
      });

      wrapper.appendChild(formulaBlock);

      const grid = document.createElement('div');
      grid.className = 'practice-grid';

      if (!chapters.length) {
        const empty = document.createElement('p');
        empty.className = 'practice-empty';
        empty.textContent = 'No hay capitulos practicos asociados a este modulo.';
        grid.appendChild(empty);
      } else {
        chapters.forEach((ch, idx) => {
          const card = document.createElement('div');
          card.className = 'practice-card';

          const t = document.createElement('p');
          t.className = 'practice-title';
          t.textContent = ch.title;
          card.appendChild(t);

          const sub = document.createElement('p');
          sub.className = 'practice-sub';
          sub.textContent = `Pagina inicial: ${ch.page}`;
          card.appendChild(sub);

          const toggle = document.createElement('button');
          toggle.className = 'practice-cta';
          toggle.textContent = idx === 0 ? 'Ocultar' : 'Mostrar';
          card.appendChild(toggle);

          const iframeWrap = document.createElement('div');
          iframeWrap.style.marginTop = '10px';
          iframeWrap.className = idx === 0 ? '' : 'hidden';

          const iframe = document.createElement('iframe');
          iframe.src = `${PRACTICO_PDF}#page=${ch.page}`;
          iframe.title = ch.title;
          iframe.style.width = '100%';
          iframe.style.height = '520px';
          iframe.style.border = '1px solid var(--border)';
          iframe.style.borderRadius = '10px';
          iframe.style.background = '#f8fafc';
          iframeWrap.appendChild(iframe);

          toggle.addEventListener('click', () => {
            const hidden = iframeWrap.classList.toggle('hidden');
            toggle.textContent = hidden ? 'Mostrar' : 'Ocultar';
          });

          card.appendChild(iframeWrap);

          grid.appendChild(card);
        });
      }

      wrapper.appendChild(grid);
      practicesEl.appendChild(wrapper);
    }

    async function loadSummaryImage() {
      summaryImageWrap.innerHTML = '';
      if (!currentModule || !currentModule.slidesFolder) return;
      const folder = currentModule.slidesFolder;
      try {
        const res = await fetch(folder);
        if (!res.ok) throw new Error('No listado');
        const html = await res.text();
        const regex = /href="([^"]+\.(png|jpg|jpeg|webp|gif))"/gi;
        const files = [];
        let m;
        while ((m = regex.exec(html)) !== null) {
          const href = decodeURIComponent(m[1]);
          if (href.includes('../')) continue;
          files.push(href);
        }
        const uniq = Array.from(new Set(files));
        if (!uniq.length) return;
        const first = uniq[0];
        let src = '';
        if (first.startsWith('http') || first.startsWith('/')) {
          src = first;
        } else if (first.startsWith(folder)) {
          src = first;
        } else {
          src = folder + first;
        }
        const img = document.createElement('img');
        img.className = 'summary-img';
        img.src = src;
        img.alt = 'Filmina resumen';
        summaryImageWrap.appendChild(img);
      } catch (e) {
        // silencioso si no se puede listar
      }
    }

    async function renderSlides() {
      slidesSelect.innerHTML = '';
      slidesStatus.textContent = 'Cargando filminas...';
      slidesViewer.innerHTML = 'Selecciona una filmina para ver el PDF.';
      const folder = currentModule.slidesFolder;
      slidesHint.textContent = folder;
      try {
        const res = await fetch(folder);
        if (!res.ok) throw new Error('No listado');
        const html = await res.text();
        const regex = /href="([^"]+\.pdf)"/gi;
        const files = [];
        let m;
        while ((m = regex.exec(html)) !== null) {
          const href = decodeURIComponent(m[1]);
          if (href.includes('../')) continue;
          files.push(href);
        }
        const uniq = Array.from(new Set(files));
        if (!uniq.length) {
          slidesStatus.textContent = 'No se encontraron PDFs en la carpeta de filminas.';
          slidesViewer.innerHTML = 'Agrega PDFs a ' + folder;
          return;
        }
        uniq.forEach((f, idx) => {
          const opt = document.createElement('option');
          const label = f.split('/').pop();
          if (f.startsWith('http')) {
            opt.value = f;
          } else if (f.startsWith('/')) {
            opt.value = f;
          } else if (f.startsWith(folder)) {
            opt.value = f;
          } else {
            opt.value = folder + f;
          }
          opt.textContent = label;
          if (idx === 0) opt.selected = true;
          slidesSelect.appendChild(opt);
        });
        slidesStatus.textContent = '';
        loadSlide(slidesSelect.value);
      } catch (e) {
        slidesStatus.textContent = 'No se pudo listar la carpeta de filminas.';
        slidesViewer.innerHTML = 'Verifica que ' + folder + ' este accesible.';
      }
    }

    function loadSlide(path) {
      if (!path) {
        slidesViewer.textContent = 'Selecciona una filmina.';
        return;
      }
      const src = encodeURI(path);
      slidesViewer.innerHTML = `<iframe src="${src}" style="width:100%;height:720px;border:0;display:block;" title="Filmina"></iframe>`;
    }

    function switchTab(tab) {
      tabButtons().forEach(btn => btn.classList.toggle('active', btn.dataset.tab === tab));
      if (tab === 'teorico') {
        document.getElementById('theoryPanel').classList.remove('hidden');
        practicesEl.classList.add('hidden');
      } else {
        document.getElementById('theoryPanel').classList.add('hidden');
        practicesEl.classList.remove('hidden');
      }
    }

    function renderPdfOptions() {
      pdfSelect.innerHTML = '';
      if (!currentModule || !currentModule.pdfs?.length) {
        const opt = document.createElement('option');
        opt.textContent = 'Sin PDFs asociados';
        pdfSelect.appendChild(opt);
        pdfViewer.textContent = 'No hay PDFs disponibles para este modulo.';
        return;
      }
      currentModule.pdfs.forEach((pdf, idx) => {
        const opt = document.createElement('option');
        opt.value = pdf.file;
        opt.textContent = pdf.label;
        if (idx === 0) opt.selected = true;
        pdfSelect.appendChild(opt);
      });
      // No cargamos automaticamente; se carga al mostrar.
    }

    function loadPdf(path) {
      if (!path) {
        pdfViewer.textContent = 'Selecciona un PDF.';
        return;
      }
      const src = encodeURI(path);
      pdfViewer.innerHTML = `<iframe src="${src}" style="width:100%;height:440px;border:0;" title="PDF"></iframe>`;
    }

    function togglePdf() {
      pdfVisible = !pdfVisible;
      // asegurar que el cuerpo este visible al mostrar
      const pdfBody = document.getElementById('pdfBody');
      if (pdfVisible) {
        pdfBody?.classList.remove('hidden');
        pdfViewer.classList.remove('hidden');
        pdfToggleBtn.textContent = 'Ocultar PDF';
        if (pdfSelect.value) loadPdf(pdfSelect.value);
      } else {
        pdfViewer.classList.add('hidden');
        pdfToggleBtn.textContent = 'Mostrar PDF';
      }
    }

    function generateQuiz() {
      if (!currentModule) return;
      const num = currentModule.id.replace('u', '').toUpperCase();
      const candidates = [
        `inputs/quiz/quizU${num}/quiz.json`,
        `inputs/quiz/quizU${num}/quizU${num}.json`,
        `inputs/quiz/quizu${num}/quiz.json`,
        `inputs/quiz/quizu${num}/quizu${num}.json`
      ];

      const tryLoad = async (path) => {
        try {
          const r = await fetch(path);
          if (!r.ok) throw new Error('No encontrado');
          return await r.json();
        } catch {
          return null;
        }
      };

      (async () => {
        let data = null;
        for (const p of candidates) {
          data = await tryLoad(p);
          if (data) break;
        }
        if (!data) {
          quizZone.innerHTML = `<p style="color:var(--muted);margin:0;">No se encontro quiz. Probe: ${candidates.join(', ')}. Agrega quiz.json o quizU#.json en la carpeta del modulo.</p>`;
          gradeBtn.style.display = 'none';
          return;
        }
        currentQuiz = (data.questions || []).map((q, idx) => ({
          q: q.question,
          options: q.options,
          answer: q.answer,
          selected: null,
          revealed: false,
          correct: false,
          scored: false,
          explanation: q.explanation || '',
          id: idx
        }));
        shuffleCurrentQuiz();
        currentQuestionIndex = 0;
        correctCount = 0;
        renderCurrentQuestion();
      })();
    }

    function shuffleCurrentQuiz() {
      for (let i = currentQuiz.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [currentQuiz[i], currentQuiz[j]] = [currentQuiz[j], currentQuiz[i]];
      }
    }

    function renderCurrentQuestion() {
      if (!currentQuiz.length) {
        quizZone.innerHTML = '<p style="color:var(--muted);margin:0;">El archivo de quiz no contiene preguntas.</p>';
        gradeBtn.style.display = 'none';
        return;
      }
      const item = currentQuiz[currentQuestionIndex];
      const total = currentQuiz.length;
        const progress = `Pregunta ${currentQuestionIndex + 1} de ${total}`;
        const btnNextLabel = currentQuestionIndex === total - 1 ? 'Terminar' : 'Siguiente';
        const feedbackText = item.revealed
          ? (item.correct ? 'Correcta. ' : (item.selected === null ? 'Mostrada sin respuesta. ' : 'Incorrecta. ')) + (item.explanation || '')
          : '';

      quizZone.innerHTML = `
        <div class="quiz-item">
          <div style="font-weight:700;color:var(--accent);margin-bottom:6px;">${progress}</div>
          <div class="quiz-question">${item.q}</div>
          <div class="options" id="optionsBox"></div>
          <div id="feedback" class="${item.revealed ? '' : 'hidden'}" style="margin-top:8px;font-weight:700;color:${item.correct ? '#15803d' : '#dc2626'};">
            ${feedbackText}
          </div>
          <div class="toggle-row" style="margin-top:10px;gap:8px;">
            <button id="respondBtn" ${item.revealed ? 'disabled' : ''}>Responder</button>
            <button id="nextBtn" ${item.revealed ? '' : 'disabled'}>${btnNextLabel}</button>
            <button id="revealBtn" ${item.revealed ? 'disabled' : ''} class="mini-btn">Mostrar respuesta</button>
            <button id="quizBtn" class="mini-btn">Regenerar test</button>
          </div>
        </div>
      `;

      const optionsBox = document.getElementById('optionsBox');
      item.options.forEach((opt, optIdx) => {
        const optEl = document.createElement('div');
        optEl.className = 'option';
        optEl.textContent = opt;
        if (item.selected === optIdx) optEl.classList.add('selected');
        if (item.revealed) {
          if (optIdx === item.answer) optEl.classList.add('correct');
          if (item.selected === optIdx && optIdx !== item.answer) optEl.classList.add('incorrect');
        }
        optEl.addEventListener('click', () => {
          if (item.revealed) return;
          item.selected = optIdx;
          renderCurrentQuestion();
        });
        optionsBox.appendChild(optEl);
      });

      document.getElementById('respondBtn').addEventListener('click', () => {
        if (item.revealed) return;
        if (item.selected === null) {
          const fb = document.getElementById('feedback');
          fb.textContent = 'Elige una opcion o usa "Mostrar respuesta".';
          fb.classList.remove('hidden');
          fb.style.color = '#dc2626';
          return;
        }
        item.revealed = true;
        item.correct = item.selected === item.answer;
        if (item.correct && !item.scored) {
          correctCount += 1;
          item.scored = true;
        }
        renderCurrentQuestion();
      });

      document.getElementById('revealBtn').addEventListener('click', () => {
        if (item.revealed) return;
        item.revealed = true;
        item.correct = false;
        item.selected = null;
        renderCurrentQuestion();
      });

      document.getElementById('nextBtn').addEventListener('click', () => {
        if (!item.revealed) return;
        if (currentQuestionIndex < total - 1) {
          currentQuestionIndex += 1;
          renderCurrentQuestion();
        } else {
          quizZone.innerHTML = `<p style="margin:0;font-weight:700;">Completado: ${correctCount} de ${total} correctas.</p>`;
        }
      });

      const regenBtn = document.getElementById('quizBtn');
      if (regenBtn) regenBtn.addEventListener('click', generateQuiz);
    }

    document.getElementById('summaryToggle').addEventListener('click', () => {
      const body = document.getElementById('summaryBody');
      const hidden = body.classList.toggle('hidden');
      document.getElementById('summaryToggle').textContent = hidden ? 'Mostrar' : 'Ocultar';
    });
    document.getElementById('slidesCollapse').addEventListener('click', () => {
      const body = document.getElementById('slidesBody');
      const hidden = body.classList.toggle('hidden');
      document.getElementById('slidesCollapse').textContent = hidden ? 'Mostrar' : 'Ocultar';
    });
    document.getElementById('quizCollapse').addEventListener('click', () => {
      const body = document.getElementById('quizBody');
      const hidden = body.classList.toggle('hidden');
      document.getElementById('quizCollapse').textContent = hidden ? 'Mostrar' : 'Ocultar';
    });
    gradeBtn.style.display = 'none'; // no usamos el boton masivo ahora
    pdfSelect.addEventListener('change', (e) => loadPdf(e.target.value));
    pdfToggleBtn.addEventListener('click', togglePdf);
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => switchTab(btn.dataset.tab));
    });
    slidesSelect.addEventListener('change', (e) => loadSlide(e.target.value));
    document.getElementById('toggleSidebar').addEventListener('click', () => {
      const layout = document.querySelector('.layout');
      const collapsed = layout.classList.toggle('collapsed');
      document.getElementById('toggleSidebar').ariaLabel = collapsed ? 'Mostrar modulos' : 'Ocultar modulos';
    });

      renderModules();
      selectModule(modules[0].id);
  </script>
</body>
</html>

